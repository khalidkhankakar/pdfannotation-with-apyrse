/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[21],{577:function(xa,ta,h){h.r(ta);var ra=h(0),na=h(7),oa=h(3);xa=h(56);var ia=h(34),ka=h(14);h=function(){function ha(){this.init()}ha.prototype.init=function(){this.xla=!1;this.pg=this.vo=this.connection=null;this.Xv={};this.ga=this.pM=null};ha.prototype.AHa=function(y){for(var ba=this,r=0;r<y.length;++r){var n=y[r];switch(n.at){case "create":this.Xv[n.author]||(this.Xv[n.author]=n.aName);this.zva(n);break;case "modify":this.ga.xr(n.xfdf).then(function(f){ba.ga.Bb(f[0])});
break;case "delete":this.ga.xr("<delete><id>"+n.aId+"</id></delete>")}}};ha.prototype.zva=function(y){var ba=this;this.ga.xr(y.xfdf).then(function(r){r=r[0];r.authorId=y.author;ba.ga.Bb(r);ba.ga.trigger(na.c.UPDATE_ANNOTATION_PERMISSION,[r])})};ha.prototype.Rua=function(y,ba,r){this.vo&&this.vo(y,ba,r)};ha.prototype.preloadAnnotations=function(y){this.addEventListener("webViewerServerAnnotationsEnabled",this.Rua.bind(this,y,"add",{imported:!1}),{once:!0})};ha.prototype.initiateCollaboration=function(y,
ba,r){var n=this;if(y){n.pg=ba;n.ga=r.ma();r.addEventListener(na.h.DOCUMENT_UNLOADED,function(){n.disableCollaboration()});n.hIa(y);var f=new XMLHttpRequest;f.addEventListener("load",function(){if(200===f.status&&0<f.responseText.length)try{var b=JSON.parse(f.responseText);n.connection=exports.da.vJa(Object(ia.k)(n.pg,"blackbox/"),"annot");n.pM=b.id;n.Xv[b.id]=b.user_name;n.ga.SV(b.id);n.connection.RMa(function(a){a.t&&a.t.startsWith("a_")&&a.data&&n.AHa(a.data)},function(){n.connection.send({t:"a_retrieve",
dId:y});n.trigger(ha.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[n.Xv[b.id],n.pM])},function(){n.disableCollaboration()})}catch(a){Object(oa.g)(a.message)}});f.open("GET",Object(ia.k)(this.pg,"demo/SessionInfo.jsp"));f.withCredentials=!0;f.send();n.xla=!0;n.ga.saa(function(b){return n.Xv[b.Author]||b.Author})}else Object(oa.g)("Document ID required for collaboration")};ha.prototype.disableCollaboration=function(){this.vo&&(this.ga.removeEventListener(ka.a.Events.ANNOTATION_CHANGED,this.vo),this.vo=
null);this.connection&&this.connection.yt();this.ga&&this.ga.SV("Guest");this.init();this.trigger(ha.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};ha.prototype.hIa=function(y){var ba=this;this.vo&&this.ga.removeEventListener(ka.a.Events.ANNOTATION_CHANGED,this.vo);this.vo=function(r,n,f){return Object(ra.b)(this,void 0,void 0,function(){var b,a,e,w,ca,z,aa,x,fa;return Object(ra.d)(this,function(ea){switch(ea.label){case 0:if(f.imported)return[2];b={t:"a_"+n,dId:y,annots:[]};return[4,ba.ga.e3()];
case 1:a=ea.ba();"delete"!==n&&(e=(new DOMParser).parseFromString(a,"text/xml"),w=new XMLSerializer);for(ca=0;ca<r.length;ca++)z=r[ca],x=aa=void 0,"add"===n?(aa=e.querySelector('[name="'+z.Id+'"]'),x=w.serializeToString(aa),fa=null,z.InReplyTo&&(fa=ba.ga.Kg(z.InReplyTo).authorId||"default"),b.annots.push({at:"create",aId:z.Id,author:ba.pM,aName:ba.Xv[ba.pM],parent:fa,xfdf:"<add>"+x+"</add>"})):"modify"===n?(aa=e.querySelector('[name="'+z.Id+'"]'),x=w.serializeToString(aa),b.annots.push({at:"modify",
aId:z.Id,xfdf:"<modify>"+x+"</modify>"})):"delete"===n&&b.annots.push({at:"delete",aId:z.Id});0<b.annots.length&&ba.connection.send(b);return[2]}})})}.bind(ba);this.ga.addEventListener(ka.a.Events.ANNOTATION_CHANGED,this.vo)};ha.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return ha}();Object(xa.a)(h);ta["default"]=h}}]);}).call(this || window)
